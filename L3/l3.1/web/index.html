<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DelayedNotifier ‚Äî –∫–∞–∫ Wildberries, —Ç–æ–ª—å–∫–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è .copy-btn */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: #f8f8f8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .wb-header {
            background: linear-gradient(90deg, #ff5e8b, #4a90e2);
            color: white;
            padding: 16px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 24px;
            letter-spacing: 0.5px;
        }

        .logo-icon {
            background: white;
            color: #8b57b5;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
        }

        .logo-text {
            text-transform: uppercase;
        }

        .logo-text span {
            font-weight: 300;
            opacity: 0.9;
        }

        .header-tagline {
            margin-left: auto;
            background: rgba(255,255,255,0.15);
            padding: 8px 16px;
            border-radius: 40px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 24px;
            flex: 1;
        }

        h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #222;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2:before {
            content: "‚Ä¢";
            color: #8b57b5;
            font-size: 28px;
        }

        .form-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.04);
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid #f0f0f0;
        }

        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .form-group {
            flex: 1 1 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: #444;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="datetime-local"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            transition: 0.2s;
            background: #fafafa;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #8b57b5;
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 87, 181, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .note {
            font-size: 12px;
            color: #888;
            margin-top: 6px;
        }

        .wb-button {
            background: #8b57b5;
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
        }

        .wb-button:hover {
            background: #7a49a3;
        }

        .wb-button:active {
            transform: scale(0.98);
        }

        .wb-button.secondary {
            background: white;
            color: #8b57b5;
            border: 1px solid #8b57b5;
            padding: 8px 16px;
            font-size: 14px;
        }

        .wb-button.secondary:hover {
            background: #f3edf9;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .refresh-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .refresh-btn:hover {
            background: #218838;
        }

        .copy-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .copy-btn:hover {
            background: #f0f0f0;
        }

        .table-wrapper {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.04);
            padding: 8px;
            border: 1px solid #f0f0f0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 16px;
            overflow: hidden;
        }

        th {
            text-align: left;
            padding: 16px 12px;
            background: #fafafa;
            color: #444;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 2px solid #eee;
        }

        td {
            padding: 16px 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
            font-size: 14px;
            color: #333;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: #fafafa;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 40px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-scheduled { 
            background: #fff3e0; 
            color: #b45b0f; 
        }
        .status-publishing { 
            background: #cfe2ff; 
            color: #084298; 
        }
        .status-sent { 
            background: #e3f5e3; 
            color: #1e7e34; 
        }
        .status-failed { 
            background: #ffe6e6; 
            color: #b02a37; 
        }
        .status-cancelled { 
            background: #e9ecef; 
            color: #495057; 
        }

        .last-error {
            color: #dc3545;
            font-size: 12px;
            max-width: 200px;
            word-break: break-word;
        }

        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .wb-footer {
            background: white;
            border-top: 1px solid #eee;
            padding: 20px 24px;
            text-align: center;
            color: #777;
            font-size: 13px;
            margin-top: 40px;
        }

        .uid-short {
            font-family: monospace;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
        }
        .uid-short:hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ Wildberries -->
    <header class="wb-header">
        <div class="logo">
            <div class="logo-icon">WB</div>
            <div class="logo-text">Delayed<span>Notifier</span></div>
        </div>
        <div class="header-tagline">
            <span>‚è∞</span> –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ¬∑ –°–∫–∏–¥–∫–∞ 99% –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ
        </div>
    </header>

    <div class="container">
        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
        <h2>–°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h2>
        <div class="form-card">
            <form id="createForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–∏—Å–ª–æ)</label>
                        <input type="number" id="user_id" name="user_id" min="1" max="1000000" value="1" required
                               placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 12345">
                        <div class="note">‚≠ê –æ—Ç 1 –¥–æ 1‚ÄØ000‚ÄØ000</div>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" name="email" placeholder="example@mail.com">
                    </div>
                    <div class="form-group">
                        <label>Telegram</label>
                        <input type="text" id="telegram" name="telegram" placeholder="yournik">
                    </div>
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                    <textarea id="content" name="content" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–∞—à –∑–∞–∫–∞–∑ –≥–æ—Ç–æ–≤..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</label>
                        <input type="datetime-local" id="send_for" name="send_for" required>
                        <div class="note">‚è≥ –º–∏–Ω–∏–º—É–º +1 –º–∏–Ω—É—Ç–∞ –æ—Ç —Å–µ–π—á–∞—Å</div>
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button type="submit" class="wb-button">
                            <span>‚úö</span> –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
        <h2>–°–æ–∑–¥–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
        <div class="table-wrapper">
            <table id="notificationsTable">
                <thead>
                    <tr>
                        <th>UID (–ø–µ—Ä–≤—ã–µ —Å–∏–º–≤–æ–ª—ã)</th>
                        <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                        <th>Email</th>
                        <th>Telegram</th>
                        <th>–¢–µ–∫—Å—Ç</th>
                        <th>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</th>
                        <th>–û—à–∏–±–∫–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="notificationsBody">
                    <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç -->
                </tbody>
            </table>
        </div>
    </div>

    <footer class="wb-footer">
        ‚í∏ DelayedNotifier, 2026 ‚Äî –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –≤–æ–≤—Ä–µ–º—è, –∫–∞–∫ –∑–∞–∫–∞–∑—ã –Ω–∞ Wildberries
    </footer>

    <script>
        // --- –°–∫—Ä–∏–ø—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–º–µ–Ω—ã (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º cancelled) ---
        const STORAGE_KEY = 'delayedNotifier_notifications_v3';

        let notifications = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            renderTable();
            setInterval(refreshAllStatuses, 5000);
        });

        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(notifications));
        }

        function loadFromStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    notifications = JSON.parse(stored);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage', e);
                    notifications = [];
                }
            }
        }

        function validateForm(user_id, email, telegram, send_for) {
            if (user_id < 1 || user_id > 1000000) {
                alert('ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 1‚ÄØ000‚ÄØ000.');
                return false;
            }
            if (!email.trim() && !telegram.trim()) {
                alert('–£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–∞–Ω–∞–ª: Email –∏–ª–∏ Telegram.');
                return false;
            }
            const scheduledTime = new Date(send_for);
            const now = new Date();
            const minTime = new Date(now.getTime() + 60 * 1000);
            if (scheduledTime < minTime) {
                alert('–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ —Ä–∞–Ω—å—à–µ, —á–µ–º —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞.');
                return false;
            }
            return true;
        }

        document.getElementById('createForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const user_id = parseInt(document.getElementById('user_id').value, 10);
            const email = document.getElementById('email').value.trim();
            const telegram = document.getElementById('telegram').value.trim();
            const content = document.getElementById('content').value.trim();
            const send_for_local = document.getElementById('send_for').value;

            if (!send_for_local) {
                alert('–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏.');
                return;
            }

            if (!validateForm(user_id, email, telegram, send_for_local)) {
                return;
            }

            const localDate = new Date(send_for_local + ':00');
            const send_for_iso = localDate.toISOString();

            const channels = [];
            if (email) channels.push('email');
            if (telegram) channels.push('telegram');

            const payload = {
                user_id: user_id,
                channel: channels,
                content: content,
                send_for: send_for_iso
            };

            try {
                const response = await fetch('/notify/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                }

                const result = await response.json();
                if (!result.uid) {
                    throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ –≤–µ—Ä–Ω—É–ª UID');
                }

                const newNotification = {
                    uid: result.uid,
                    user_id: user_id,
                    email: email,
                    telegram: telegram,
                    content: content,
                    send_for: send_for_iso,
                    status: 'scheduled',
                    send_at: null,
                    last_error: ''
                };
                notifications.push(newNotification);
                saveToStorage();
                renderTable();

                fetchNotificationStatus(result.uid);

                e.target.reset();
                document.getElementById('user_id').value = 1;

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ' + error.message);
            }
        });

        async function fetchNotificationStatus(uid) {
            try {
                const response = await fetch(`/notify/${uid}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        // –ï—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —É–¥–∞–ª—è–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
                        notifications = notifications.filter(n => n.uid !== uid);
                        saveToStorage();
                        renderTable();
                        return;
                    }
                    throw new Error(`HTTP error ${response.status}`);
                }
                const data = await response.json();
                const index = notifications.findIndex(n => n.uid === uid);
                if (index !== -1) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
                    notifications[index].status = data.status || notifications[index].status;
                    notifications[index].send_at = data.send_at || null;
                    notifications[index].last_error = data.last_error || '';
                    saveToStorage();
                    renderTable();
                }
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è UID ${uid}:`, error);
            }
        }

        async function refreshAllStatuses() {
            for (const n of notifications) {
                await fetchNotificationStatus(n.uid);
            }
        }

        // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã: –Ω–µ —É–¥–∞–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –µ–≥–æ —Å—Ç–∞—Ç—É—Å –Ω–∞ "cancelled"
        async function cancelNotification(uid) {
            if (!confirm('–û—Ç–º–µ–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?')) return;
            try {
                const response = await fetch(`/notify/${uid}`, { method: 'DELETE' });
                if (!response.ok && response.status !== 404) {
                    throw new Error(`HTTP error ${response.status}`);
                }
                
                // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ
                const index = notifications.findIndex(n => n.uid === uid);
                if (index !== -1) {
                    // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª 404, –≤–æ–∑–º–æ–∂–Ω–æ, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ, –Ω–æ –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–º–µ—Ç–∏–º –µ–≥–æ –∫–∞–∫ cancelled
                    // –∏–ª–∏ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞, –Ω–æ –ø–æ —É—Å–ª–æ–≤–∏—é –º—ã —Ö–æ—Ç–∏–º –æ—Å—Ç–∞–≤–∏—Ç—å.
                    // –õ—É—á—à–µ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø–æ—Å—Ç–∞–≤–∏–º —Å—Ç–∞—Ç—É—Å "cancelled".
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å /notify/{uid}, –Ω–æ —ç—Ç–æ –∑–∞–º–µ–¥–ª–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
                    notifications[index].status = 'cancelled';
                    // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ last_error, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    // notifications[index].last_error = '';
                    saveToStorage();
                    renderTable();
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ: ' + error.message);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('UUID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + text);
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('UUID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω (—á–µ—Ä–µ–∑ fallback): ' + text);
            });
        }

        function formatDate(value) {
            if (value == null) return '-';
            if (typeof value !== 'string') return '-';
            const d = new Date(value);
            return isNaN(d.getTime()) ? '-' : d.toLocaleString();
        }

        function shortenUid(uid) {
            if (!uid) return '-';
            return uid.substring(0, 8) + '‚Ä¶';
        }

        function renderTable() {
            const tbody = document.getElementById('notificationsBody');
            tbody.innerHTML = '';

            if (notifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align:center; padding: 40px;">ü•ù –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –°–∞–º–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞—Ç—å!</td></tr>';
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ (–æ—Ç –±–ª–∏–∂–∞–π—à–∏—Ö –∫ –¥–∞–ª—å–Ω–∏–º)
            notifications.sort((a, b) => new Date(a.send_for) - new Date(b.send_for));

            for (const n of notifications) {
                const row = document.createElement('tr');
                const safeContent = n.content.replace(/"/g, '&quot;');
                row.innerHTML = `
                    <td>
                        <span class="uid-short" title="${n.uid}" onclick="copyToClipboard('${n.uid}')">${shortenUid(n.uid)}</span>
                        <button class="copy-btn" onclick="copyToClipboard('${n.uid}')" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å UUID">üìã</button>
                    </td>
                    <td>${n.user_id}</td>
                    <td>${n.email || '-'}</td>
                    <td>${n.telegram || '-'}</td>
                    <td title="${safeContent}">${n.content.length > 30 ? n.content.substring(0, 27) + '...' : n.content}</td>
                    <td>${formatDate(n.send_for)}</td>
                    <td><span class="status-badge status-${n.status}">${n.status || 'unknown'}</span></td>
                    <td>${formatDate(n.send_at)}</td>
                    <td>${n.last_error ? `<div class="last-error">${n.last_error}</div>` : '-'}</td>
                    <td class="actions">
                        <button class="refresh-btn" onclick="fetchNotificationStatus('${n.uid}')">‚ü≥</button>
                        <button class="delete-btn" onclick="cancelNotification('${n.uid}')" title="–û—Ç–º–µ–Ω–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">‚úï</button>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è onclick
        window.fetchNotificationStatus = fetchNotificationStatus;
        window.cancelNotification = cancelNotification;
        window.copyToClipboard = copyToClipboard;
    </script>
</body>
</html>